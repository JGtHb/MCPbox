# MCPbox Squid Proxy â€” PyPI-only egress for sandbox
#
# This proxy restricts the sandbox container's outbound HTTPS traffic
# to PyPI domains only (pypi.org, files.pythonhosted.org), preventing
# data exfiltration via pip install or raw socket access.

# Minimal ACLs (squid 7 requires 'all' instead of '0.0.0.0/0')
acl localnet src all
acl SSL_ports port 443
acl CONNECT method CONNECT

# Load allowed domains from file
acl allowed_domains dstdomain "/etc/squid/allowed-domains.txt"

# Only allow CONNECT (HTTPS tunnel) to allowed domains on port 443
http_access allow CONNECT SSL_ports allowed_domains
http_access deny CONNECT

# Deny all non-CONNECT traffic (no plain HTTP)
http_access deny all

# Listen on port 3128
http_port 3128

# PID file location (must be in a writable tmpfs under read_only containers)
pid_filename /var/run/squid/squid.pid

# Disable caching (we're just a filtering proxy)
cache deny all

# Minimal logging
access_log stdio:/dev/stdout
cache_log stdio:/dev/stderr

# Security: don't reveal internal info
via off
forwarded_for delete
httpd_suppress_version_string on

# Reduce memory footprint
cache_mem 8 MB
maximum_object_size 0 KB
